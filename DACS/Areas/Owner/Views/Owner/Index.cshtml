@model DACS.Models.ViewModels.OwnerDashboardViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
	Layout = null;
}
<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - Owner Dashboard</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
	<link rel="stylesheet" href="~/css/AdminLayout.css" />
    <style>
        /* Basic CSS - move to external files if possible */
		body, html {
			height: 100%;
			font-size: 16px; /* hoặc 1rem */
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		.container {
			display: grid;
			max-width: 100%;
			width: 100%;
			margin: 0;
			padding: 0;
			flex-direction: row;
		}

		.sidebar {
			background-color: #212529;
			color: #fff;
			padding: 15px;
			width: 250px;
			flex-shrink: 0;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}

			.sidebar h2 {
				border-bottom: 1px solid #495057;
				padding-bottom: 10px;
				font-size: 2.6rem;
				margin-bottom: 1rem;
				font-weight: 600;
			}

			.sidebar .nav {
				flex-grow: 1;
			}

			.sidebar .nav-link {
				color: #adb5bd;
				padding: 8px 15px;
				border-radius: 0.25rem;
				margin-bottom: 5px;
				font-size: 1.2rem;
			}

				.sidebar .nav-link.active, .sidebar .nav-link:hover {
					color: #fff;
					background-color: #495057;
				}

			.sidebar .nav-item.mt-auto {
				margin-top: auto;
				border-top: 1px solid #495057;
				padding-top: 15px;
			}

			.sidebar .logout-form button {
				padding: 8px 15px;
				color: #dc3545;
				background: none;
				border: none;
				width: 100%;
				text-align: left;
				font-size: 0.9rem;
			}

				.sidebar .logout-form button:hover {
					background-color: rgba(220, 53, 69, 0.1);
					color: #bd2130;
				}

		.main-content-area {
			padding: 25px;
			background-color: #f8f9fa;
			flex-grow: 1;
			overflow-y: auto;
		}

		.header {
			font-size: 1.75rem;
			font-weight: 500;
			margin-bottom: 1rem;
			color: #343a40;
		}

		.stat-card {
			background-color: #fff;
			border-radius: 0.375rem;
			padding: 15px;
			margin-bottom: 1rem;
			box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
			text-align: center;
		}

			.stat-card .value {
				font-size: 1.5rem;
				font-weight: 600;
			}

			.stat-card .label {
				font-size: 0.9rem;
				color: #6c757d;
			}

		.filter-section {
			background-color: #fff;
			padding: 15px;
			border-radius: 0.375rem;
			margin-bottom: 1.5rem;
			box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
		}

		.table th {
			font-weight: 600;
			font-size: 0.85rem;
		}

		.table td {
			font-size: 0.85rem;
			vertical-align: middle;
		}

		.table .actions form, .table .actions a, .table .actions button {
			margin-right: 3px;
			display: inline-block;
		}
		/* Adjust spacing */
		.table .actions .btn-sm {
			padding: 0.2rem 0.4rem;
			font-size: 0.75rem;
		}
		/* Smaller buttons */
		.table .badge {
			font-size: 0.75rem;
			padding: 0.3em 0.5em;
		}

		.user-display span {
			display: block;
		}

		.user-display small {
			color: #6c757d;
			font-size: 0.9em;
		}
    </style>
    </head>
<body>

    @* --- Main Layout Container --- *@
    <div class="d-flex">
        @* --- Sidebar --- *@
        <div class="sidebar">
            <h2>OWNER</h2>
            <ul class="nav flex-column">
                @* Điều chỉnh các asp-controller và asp-action cho phù hợp với cấu trúc của bạn *@
                <li class="nav-item"><a asp-area="Owner" asp-controller="Owner" asp-action="Index" class="nav-link active"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="DoanhThu" asp-action="Index" class="nav-link"><i class="fas fa-chart-line me-2"></i> Doanh thu</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="QuanLyND" asp-action="Index" class="nav-link"><i class="fas fa-users me-2"></i> Quản lý Tài khoản</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="QuanLySP" asp-action="Index" class="nav-link"><i class="fas fa-box-open me-2"></i> Quản lý Sản phẩm</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="QuanLyXNK" asp-action="Index" class="nav-link"><i class="fas fa-truck-loading me-2"></i> Quản lý Thu gom</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="QuanLyDonHang" asp-action="Index" class="nav-link"><i class="fas fa-receipt me-2"></i> Quản lý Đơn Hàng</a></li>
                <li class="nav-item"><a asp-area="Owner" asp-controller="QuanLyThanhToan" asp-action="Index" class="nav-link"><i class="fas fa-credit-card me-2"></i> Quản lý Thanh toán</a></li>
                
               
            </ul>
			<div class="nav-item mt-auto ">
				<button type="submit" class="text-danger border-0 bg-transparent p-0 w-100 text-start mt-1">
					@* Adjusted button style to better match list items *@
					<a href="/home/index" class="border-0 text-danger" style="text-decoration: none;"><i class="fas fa-sign-out-alt fa-fw me-2"></i> Về trang chủ</a>
				</button>
			</div>
        </div>

		<div class="main-content-area">
			<div class="page-header">Dashboard Tổng Quan - Chào @Model.OwnerName!</div>

			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="stat-card">
						<div class="value text-success">@Model.MonthlyRevenue.ToString("N0") đ</div>
						<div class="label">Doanh thu (Tháng)</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="stat-card">
						<div class="value text-info">@Model.NewOrdersThisWeek</div>
						<div class="label">Đơn hàng mới (Tuần)</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="stat-card">
						<div class="value text-primary">@Model.NewUsersThisMonth</div>
						<div class="label">Người dùng mới (Tháng) <small class="text-muted">(Tổng hoạt động)</small></div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="stat-card">
						<div class="value text-warning">@Model.PendingCollectionRequests</div>
						<div class="label">YC Thu gom chờ xử lý</div>
					</div>
				</div>
			</div>

			<div class="row mt-3">
				<div class="col-md-4 mb-3">
					<div class="card shadow-sm quick-link-card h-100">
						<a asp-area="Owner" asp-controller="QuanLyND" asp-action="Index" class="card-body text-center">
							<i class="fas fa-users text-primary fa-2x mb-2"></i>
							<h6 class="card-title mt-2">Quản lý Tài khoản</h6> <p class="card-text small text-muted">Xem, sửa, khóa tài khoản...</p>
						</a>
					</div>
				</div>
				<div class="col-md-4 mb-3">
					<div class="card shadow-sm quick-link-card h-100">
						<a asp-area="Owner" asp-controller="QuanLySP" asp-action="Index" class="card-body text-center">
							<i class="fas fa-box-open text-success fa-2x mb-2"></i>
							<h6 class="card-title mt-2">Quản lý Sản Phẩm</h6>
							<p class="card-text small text-muted">Thêm, sửa, xóa sản phẩm...</p>
						</a>
					</div>
				</div>
				<div class="col-md-4 mb-3">
					<div class="card shadow-sm quick-link-card h-100">
						<a asp-area="Owner" asp-controller="QuanLyDonHang" asp-action="Index" class="card-body text-center">
							<i class="fas fa-receipt text-info fa-2x mb-2"></i>
							<h6 class="card-title mt-2">Quản lý Đơn Hàng</h6>
							<p class="card-text small text-muted">Xác nhận, hủy, theo dõi đơn...</p>
						</a>
					</div>
				</div>
			</div>

			<div class="row mt-3">
				<div class="col-12">
					<div class="card shadow-sm">
						<div class="card-body">
							<h5 class="card-title">Biểu đồ Doanh thu (7 ngày gần nhất - Triệu VND)</h5>
							@* Thêm một div bao bọc canvas để kiểm soát kích thước tốt hơn *@
							<div class="chart-wrapper" style="position: relative; height: 300px; width: 100%;">
								<canvas id="dashboardRevenueChart"></canvas> @* Bỏ height="100" *@
							</div>
							@if (Model.RevenueChartData == null || !Model.RevenueChartData.Any() || Model.RevenueChartLabels == null || !Model.RevenueChartLabels.Any())
							{
								<p class="text-center text-muted mt-2 no-chart-data-message"><small>(Không có dữ liệu doanh thu để hiển thị biểu đồ)</small></p>
							}
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
			document.addEventListener('DOMContentLoaded', function () {
			const canvasElement = document.getElementById('dashboardRevenueChart');
			// Dùng querySelector để lấy thẻ p thông báo (nếu bạn muốn ẩn/hiện nó bằng JS)
			const noDataMessageElement = document.querySelector('.no-chart-data-message');

			// Đảm bảo Model và các thuộc tính của nó không null trước khi serialize
			const revenueLabels = @Html.Raw(Model?.RevenueChartLabels != null ? Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueChartLabels) : "[]");
			const revenueData = @Html.Raw(Model?.RevenueChartData != null ? Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueChartData) : "[]");

			// --- Bước Debug Quan Trọng ---
			console.log('Revenue Labels (dữ liệu thô từ Model):', @Html.Raw(Model?.RevenueChartLabels != null ? "'" + Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueChartLabels) + "'" : "'[]'"));
			console.log('Revenue Data (dữ liệu thô từ Model):', @Html.Raw(Model?.RevenueChartData != null ? "'" + Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueChartData) + "'" : "'[]'"));
			console.log('Parsed Revenue Labels (sau khi gán vào biến JS):', revenueLabels);
			console.log('Parsed Revenue Data (sau khi gán vào biến JS):', revenueData);
			// --- Kết thúc Bước Debug ---

			if (canvasElement && revenueLabels && revenueLabels.length > 0 && revenueData && revenueData.length > 0) {

				// Nếu có dữ liệu và biểu đồ sẽ được vẽ, ẩn thông báo "Không có dữ liệu" từ Razor (nếu nó đang hiển thị)
				if (noDataMessageElement) {
					noDataMessageElement.style.display = 'none';
				}

				new Chart(canvasElement, { // Sử dụng canvasElement thay vì ctx (ctx là context 2d, Chart.js cần element)
					type: 'line',
					data: {
						labels: revenueLabels,
						datasets: [{
							label: 'Doanh thu (Triệu VND)',
							data: revenueData,
							borderColor: 'rgb(75, 192, 192)',
							backgroundColor: 'rgba(75, 192, 192, 0.2)',
							tension: 0.1,
							fill: true
						}]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false, // *** THAY ĐỔI QUAN TRỌNG ***
													// false: cho phép biểu đồ co giãn tự do theo kích thước của div cha (chart-wrapper)
						scales: {
							y: {
								beginAtZero: true,
								ticks: {
									callback: function(value, index, values) {
										return value + ' Tr';
									}
								}
							}
							// Bạn có thể thêm cấu hình cho trục x nếu cần
							// x: { ... }
						}
						// Bạn có thể thêm các plugins khác nếu cần, ví dụ:
						// plugins: {
						// legend: { display: true },
						// tooltip: { enabled: true }
						// }
					}
				});
			} else {
				console.warn('Biểu đồ không được khởi tạo: Canvas không tìm thấy hoặc không có đủ dữ liệu.');
				// Thông báo <p> từ Razor sẽ hiển thị nếu dữ liệu trống.
				// Không cần vẽ thêm lên canvas ở đây trừ khi bạn muốn một fallback phức tạp hơn.
			}
		});
	</script>
</body>
</html>